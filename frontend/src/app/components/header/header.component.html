<nav class="rr-topbar">
    <div class="rr-tabs rr-no-scrollbar">
        <ul
            class="rr-tabs__list"
            (dragover)="handleTabStripDragOver($event)"
            (drop)="handleTabStripDrop($event)"
        >
            @for (file of files(); track file.id; let i = $index) {
                <li class="rr-tab"
                    draggable="true"
                    [class.rr-tab--active]="currentFileIndex() === i"
                    [class.rr-tab--dragging]="draggingIndex === i"
                    [class.rr-tab--dragover]="dragOverIndex === i"
                    (dragstart)="handleTabDragStart($event, i)"
                    (dragover)="handleTabDragOver($event, i)"
                    (drop)="handleTabDrop($event, i)"
                    (dragend)="handleTabDragEnd()"
                    (contextmenu)="handleContextMenu($event, i)"
                >
                    <a
                        class="rr-tab__link"
                        aria-current="page"
                        href="#"
                        (click)="$event.preventDefault(); onFileSelect.emit(i)"
                    >
                        <span class="rr-tab__title" [title]="file.displayName || file.name">
                          {{file.displayName || file.name}}
                        </span>

                        <button
                            type="button"
                            class="rr-icon-btn rr-icon-btn--danger"
                            draggable="false"
                            (click)="$event.stopPropagation(); $event.preventDefault(); onCloseFile.emit(i)"
                            title="Close File"
                        >
                            <span class="rr-sr-only">Close file</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                        </button>
                    </a>
                </li>
            }
        </ul>
    </div>

    @if (contextMenu.show) {
        <div class="rr-menu-backdrop" (click)="closeContextMenu()" (contextmenu)="$event.preventDefault(); closeContextMenu()"></div>
        <div class="rr-menu"
             [style.left.px]="contextMenu.x"
             [style.top.px]="contextMenu.y">
            @if (contextMenu.filePath) {
                <button type="button"
                        class="rr-menu__item"
                        (click)="revealInFinder()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2" /></svg>
                    <span>Reveal in Finder</span>
                </button>
            } @else {
                <div class="rr-menu__note">
                    File not saved to disk
                </div>
            }
            <div class="rr-menu__sep"></div>
            <button type="button"
                    class="rr-menu__item"
                    (click)="closeTab()">
                <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                <span>Close Tab</span>
            </button>
            <button type="button"
                    class="rr-menu__item"
                    (click)="closeOtherTabs()">
                <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /><path d="M14 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /><path d="M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /></svg>
                <span>Close Other Tabs</span>
            </button>
        </div>
    }

    <div class="rr-topbar__right">
        @if (appVersion()) {
            <span class="rr-badge">
                v{{ appVersion() }}
            </span>
        }
        <div class="rr-select-wrap">
            @if(environments().length > 0) {
                <select class="rr-select"
                    [ngModel]="selectedEnv()"
                    (ngModelChange)="onEnvChange.emit($event)"
                >
                    @for (env of environments(); track env) {
                        <option [value]="env">{{env}}</option>
                    }
                </select>
                <div class="rr-select-wrap__chev">
                    <svg class="rr-btn__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            } @else {
                <span class="rr-badge">
                    No Environments
                </span>
            }
        </div>

        <button
            type="button"
            class="rr-btn btn-ambient"
            (click)="onNewFile.emit()"
            title="New File"
            aria-label="Create new file"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--primary" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
            <span>New</span>
        </button>

        <button
                type="button"
                class="rr-btn btn-ambient"
                (click)="onOpenFile.emit()"
                title="Open File"
                aria-label="Open existing file"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--primary" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /></svg>
            <span>Open</span>
        </button>

        <button
            type="button"
            class="rr-btn btn-ambient"
            (click)="onOpenExamples.emit()"
            title="Open Examples"
            aria-label="Open examples file"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--accent" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 9h1" /><path d="M9 13h6" /><path d="M9 17h6" /></svg>
            <span>Examples</span>
        </button>

        <button
                type="button"
                class="rr-btn btn-ambient"
                (click)="onSaveFile.emit()"
                title="Save File"
                aria-label="Save file"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--success" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M19 21H5a2 2 0 0 1 -2 -2V7a2 2 0 0 1 2 -2h11l5 5v9a2 2 0 0 1 -2 2z" /><path d="M17 21v-8H7v8" /><path d="M7 3v4" /></svg>
            <span>Save</span>
        </button>

        <button
            type="button"
            class="rr-btn btn-ambient"
            (click)="onSaveFileAs.emit()"
            title="Save As"
            aria-label="Save file as"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--success" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M19 21H5a2 2 0 0 1 -2 -2V7a2 2 0 0 1 2 -2h11l5 5v9a2 2 0 0 1 -2 2z" /><path d="M17 21v-8H7v8" /><path d="M7 3v4" /><path d="M15 3v4" /></svg>
            <span>Save As</span>
        </button>

        <button
                type="button"
                class="rr-btn btn-ambient"
                (click)="onSecretsClick.emit()"
                title="Manage Secrets"
                aria-label="Manage secrets"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--warning" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z" /><path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0" /><path d="M8 11v-4a4 4 0 1 1 8 0v4" /></svg>
            <span>Secrets</span>
        </button>

        <button
                type="button"
                class="rr-btn btn-ambient"
                (click)="onDonateClick.emit()"
                title="Support Development"
                aria-label="Support Development"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--danger" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" /></svg>
            <span>Support</span>
        </button>

        <button
                type="button"
                class="rr-btn btn-ambient"
                (click)="onHistoryClick.emit()"
                title="History"
                aria-label="View request history"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--primary" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" /><path d="M12 8l0 4l2 2" /><path d="M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5" /></svg>
            <span>History</span>
        </button>

        <button
                type="button"
                class="rr-btn btn-ambient"
                (click)="toggleTheme()"
                [title]="isDarkTheme() ? 'Switch to light theme' : 'Switch to dark theme'"
                aria-label="Toggle theme"
        >
            @if (isDarkTheme()) {
                <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--warning" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 3v1" />
                    <path d="M12 20v1" />
                    <path d="M3 12h1" />
                    <path d="M20 12h1" />
                    <path d="M18.364 5.636l-.707.707" />
                    <path d="M6.343 17.657l-.707.707" />
                    <path d="M5.636 5.636l.707.707" />
                    <path d="M17.657 17.657l.707.707" />
                    <circle cx="12" cy="12" r="4" />
                </svg>
                <span>Light</span>
            } @else {
                <svg xmlns="http://www.w3.org/2000/svg" class="rr-btn__icon rr-icon--primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z" />
                </svg>
                <span>Dark</span>
            }
        </button>
    </div>
</nav>
