<div class="history-drawer" [class.history-drawer--open]="isOpen()" [class.history-drawer--closed]="!isOpen()" tabindex="-1">

  <div class="history-drawer__header">
    <div class="history-drawer__title">
      <h5 class="history-drawer__title-text">History</h5>
      @if (history().length > 0) {
        <div class="history-drawer__subtitle">{{ history().length }} entr{{ history().length === 1 ? 'y' : 'ies' }}</div>
      } @else {
        <div class="history-drawer__subtitle history-drawer__subtitle--empty">No entries yet</div>
      }
    </div>
    <button type="button" class="rr-icon-btn history-drawer__close" (click)="onClose.emit()" aria-label="Close history">
      <svg xmlns="http://www.w3.org/2000/svg" class="rr-icon rr-icon--md" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 6L6 18M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <div class="history-drawer__body rr-no-scrollbar">
    @if (history().length > 0) {
      <div class="history-list">
        @for (item of history(); track item.timestamp) {
          <div
            class="history-item"
            [class.history-item--selected]="selectedItem() === item"
            (click)="onItemClick.emit(item)"
          >
            <div class="history-item__top">
              <div class="history-item__tags">
                <span class="history-item__method rr-mono" [attr.data-method]="item.method">{{ item.method }}</span>
                <span
                  class="history-item__status rr-mono"
                  [attr.data-status]="item.status >= 200 && item.status < 300 ? 'success' : (item.status >= 300 && item.status < 400 ? 'redirect' : ((item.status >= 400 || item.status === 0) ? 'error' : 'neutral'))"
                >
                  {{ item.status || 'ERR' }}
                </span>
              </div>
              <span class="history-item__time rr-mono">{{ item.responseTime }}ms</span>
            </div>

            <div class="history-item__url rr-mono" [title]="item.url">{{ item.url }}</div>

            <div class="history-item__bottom">{{ formatTime(item.timestamp) }}</div>
          </div>
        }
      </div>
    } @else {
      <div class="history-empty">
        <svg xmlns="http://www.w3.org/2000/svg" class="rr-icon rr-icon--lg history-empty__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 8l0 4l2 2" />
          <path d="M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5" />
        </svg>
        <p class="history-empty__title">No request history yet.</p>
        <small class="history-empty__subtitle">Requests you send will appear here.</small>
      </div>
    }
  </div>
</div>

@if (isOpen()) {
  <div class="history-drawer__backdrop" (click)="onClose.emit()"></div>
}